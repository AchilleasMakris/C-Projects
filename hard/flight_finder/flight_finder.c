#include <stdio.h>

#define INDENTATION "    "

/* Ονόματα πόλεων */
const char *city_names[] = {
    "Αθήνα", "Λονδίνο", "Ρώμη", "Παρίσι", "Νέα Υόρκη", "Βερολίνο", "Βαρκελώνη", "Μιλάνο", "Τόκιο", "Σίδνεϊ"};


/* Διάρκεια πτήσεων */
float flight_durations[10][10] = {
    {0.0, 4.0, 2.0, -1.0, 9.5, -1.0, -1.0, -1.0, -1.0, -1.0},
    {4.0, 0.0, -1.0, 1.0, 7.0, -1.0, -1.0, -1.0, -1.0, -1.0},
    {2.0, -1.0, 0.0, -1.0, -1.0, 1.5, -1.0, 1.5, -1.0, -1.0},
    {-1.0, 1.0, -1.0, 0.0, -1.0, -1.0, 1.5, -1.0, -1.0, -1.0},
    {9.5, 7.0, -1.0, -1.0, 0.0, -1.0, 8.0, -1.0, 13.0, -1.0},
    {-1.0, -1.0, 1.5, -1.0, -1.0, 0.0, -1.0, 1.5, -1.0, -1.0},
    {-1.0, -1.0, -1.0, 1.5, 8.0, -1.0, 0.0, -1.0, -1.0, -1.0},
    {-1.0, -1.0, 1.5, -1.0, -1.0, 1.5, -1.0, 0.0, -1.0, -1.0},
    {-1.0, -1.0, -1.0, -1.0, 13.0, -1.0, -1.0, -1.0, 0.0, 9.5},
    {-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 9.5, 0.0}
    };




/* Ορισμός συναρτήσεων */
void print_city_options();
int get_city_index(int);
void add_duration(float, int, int);
void find_routes(int, int, int, int);
void request_departure_time(int*, int*);



int main()
{
    // system("chcp 1253>nul");
    int hours, minutes;

    /* Ερώτημα 1. Είσοδος ώρας και αμυντικός προγραμματισμός */
    /* Συνεχής είσοδος από τον χρήστη μέχρι να δώσει έγκυρη ώρα */
    
    /*Εκτύπωση μηνύματος στον χρήστη και εισαγωγή της ώρας*/


    request_departure_time(&hours, &minutes);

    /* Ερώτημα 2. Εκτύπωση επιλογών πόλεων. */
    print_city_options();

    /* Ερώτημα 2.  Αμυντικός προγραμματισμός για την επιλογή πόλης αναχώρησης  */
    int departure, arrival;
    do
    {
        printf("\nΔώσε τον αριθμό της πόλης αναχώρησης: ");
        scanf("%u", &departure);
        /* Έλεγχος για την τιμή εισόδου του χρήστη */
        if(departure < 0 || departure > 9)
        {
            printf("\nΜη έγκυρη επιλογή πόλης αναχώρησης. \n");
            continue;
        }
        
        printf("\nΔώσε τον αριθμό της πόλης άφιξης: ");
        scanf("%u", &arrival);
        /* Έλεγχος για την τιμή εισόδου του χρήστη */
        if(arrival < 0 || arrival > 9)
        {
            printf("\nΜη έγκυρη επιλογή πόλης άφιξης.");
            continue;
        }
        /* 'Ελεγχος αν η πόλη αναχώρησης είναι ίδια με την πόλη άφιξης*/
        if(departure == arrival)
        {
            printf("\nΗ πόλη αναχώρησης και άφιξης δεν μπορεί να είναι η ίδια. Δοκιμάστε ξανά.\n");
            continue;
        }

        break;

    } while (1);

    

    // Εύρεση επιλογών πτήσεων (απευθείας ή με μετεπιβίβαση)
    /* Ερώτηματα 3-4 */


    find_routes(departure, arrival, hours, minutes);

    return 0;
}

/* Ερώτημα 1 */
void request_departure_time(int *hours, int *minutes)
{
    /* Δήλωση μεταβλητών */
    int time;
    /* Κάνουμε αμυντικό προγραμματισμό για έλεγχο της ώρας */
    do
    {
        printf("Εισάγετε την ώρα σε μορφή τετραψήφιου θετικού αριθμού (π.χ. 1445): ");
        scanf("%d", &time);
        
        /* Παίρνουμε τα 2 πρώτα ψηφία της ώρας*/
        *hours = time / 100;
        /* Παίρνουμε το υπόλοιπο της διαίρεσης για να απομονόσουμε τα 2 τελευταία ψηφία της ώρας */
        *minutes = time % 100;
        /* Έλεγχος αν οι ώρες είναι μεταξύ 0-23 και τα λεπτά μεταξύ 0-59 */
        if (*hours >= 0 && *hours <= 23 && *minutes >= 0 && *minutes <= 59)
        {
            break; // Αν η ώρα είναι έγκυρη, σταματάμε το loop
        }

        /* Αλλιώς εκτυπώνουμε το μήνυμα λάθους! */
        printf("Η ώρα δεν είναι σωστή. Προσπαθήστε ξανά.\n");

    } while(1);
    /* Κάνουμε Print την ώρα σε μορφή HHMM με πάντα 2 ψηφία για αυτόματη συμπλ΄ήρωση των μηδενικών*/
    printf("\nΏρα αναχώρησης: (%02d:%02d)\n", *hours, *minutes);
}


/* Ερώτημα 2. Εκτύπωση επιλογών πόλεων */
void print_city_options()
{
    printf("Επιλογές πόλεων: \n");

    /* Εκτύπωση των πόλεων μαζι με τον αύξον αριθμό τους*/
    for(int i = 0; i < 10; i++)
    {
        printf("%d: %s\n", i, city_names[i]);
    }
	
}

/* Συνάρτηση που θα επιστρέφει τον δείκτη της πόλης ή -1 */
int get_city_index(int choice)
{
    
    /* Αμυντικός προγραμματισμός για την είσοδο */
   while (choice < 0 || choice >= 10) {
        printf("Μη έγκυρη επιλογή! Παρακαλώ επιλέξτε ξανά (0-9): ");
        scanf("%d", &choice);
    }
    return choice;
}


/* Ερώτημα 3 */
/* Εδώ θα εκτυπώνεται η διάρκεια πτήσης για κάθε επιλογή. */
/* Όταν θα υλοποιήσετε το ερώτημα 4 θα μπορείτε να ενσωματώσετε εδώ την συνάρτηση add_duration η οποία θα εκτυπώνει την ώρα άφιξης*/
void find_routes(int departure, int arrival, int departure_hour, int departure_minutes)
{
    printf("\n\n************* Αποτελέσματα αναζήτησης *************\n");
    int found_direct = 0;
    /* Έλεγχος απευθείας πτήσης*/
    if(flight_durations[departure][arrival] != -1)
    {
        /* αλλάζουμε το flag σε 1*/
        found_direct = 1;

        /* Εμφανίζουμε τα ονόματα των πόλεων και τη διάρκεια της απευθείας πτήσης.*/
        printf("\nΕπιλογή 1: Απευθείας πτήση απο %s προς %s. Ώρες: %.1f", city_names[departure], city_names[arrival], flight_durations[departure][arrival]);

        /* Εμφάνιση της ώρας άφιξης.*/
        add_duration(flight_durations[departure][arrival], departure_hour, departure_minutes);
        /* Εφόσον βρέθηκε απευθείας πτήση, τερματίζουμε την συνάρτηση*/
        return;
    }
    
    int found_alternative = 0;
    
    /* Εύρεση πτήσεων με μία μετεπιβίβαση*/
    /* Ε΄λέγχουμε κάθε διαθέσιμη πόλη για πιθανή μετεπιβίβαση */
    for(int i = 0; i < 10; i++)
    {
        /* Έλεγχος παραμέτρων ώστε η πόλη να μήν είναι ίδια με την πόλη αναχώρησης και την πόλη άφηξης*/
        if(i != departure && i != arrival)
        {
            /* Ελέγχουμε αν η πόλη στην θέση i έχει διαθέσιμη πτήση και απο την πόλη αναχώρισης προς αυτή αλλά και απο αυτή στην π΄΄ολη άφιξης. */
            if(flight_durations[departure][i] != -1 && flight_durations[i][arrival] != -1)
            {
                found_alternative++;
                /* Υπολογίζουμε τη συνολική διάρκεια της διαδρομής (πτήση αναχώρησης -> ενδιάμεση + πτήση ενδιάμεσης -> άφιξης) */
                float total_flight_duration = flight_durations[departure][i] + flight_durations[i][arrival];

                /* Εμφανίζουμε την επιλογή με την ενδιάμεση πόλη */
                printf("\nΕπιλογή %d: Με μετεπιβίβαση %s\n", found_alternative, city_names[i]);

                /* Εμφανίζουμε την πρώτη πτήση (από την πόλη αναχώρησης προς την ενδιάμεση) */
                printf("%s Πτήση απο %s προς %s. Ώρες %.1f\n", INDENTATION, city_names[departure], city_names[i], flight_durations[departure][i]);

                /* Εμφανίζουμε τη δεύτερη πτήση (από την ενδιάμεση προς την πόλη άφιξης) */
                printf("%s Πτήση απο %s προς %s. Ώρες %.1f \n", INDENTATION, city_names[i], city_names[arrival], flight_durations[i][arrival]);

                /* Εμφανίζουμε τη συνολική διάρκεια της διαδρομής */
                printf("%s Συνολική διάρκεια. Ώρες %.1f\n", INDENTATION, total_flight_duration);
                
                /* Εμφάνιση της ώρας άφιξης.*/
                add_duration(total_flight_duration, departure_hour, departure_minutes);

            }
        }
    }
    

    /* Μήνυμα σε περίπτωση που δεν βρεθούν διαθέσιμες πτήσεις*/
    if (found_alternative == 0)
    {
        printf("Δεν υπάρχει διαθέσιμες πτήσεις απο %s προς %s. \n", city_names[departure], city_names[arrival]);
    }
}


/* Ερώτημα 4 */
/* Η συνάρτηση θα έχει παραμέτρους ώρα, λεπτά και διάρκεια.  */
/* Η διάρκεια θα προστίθεται στην ώρα και στα λεπτά και θα εκτυπώνεται η νέα ώρα */
/* Εάν η νέα ώρα είναι την επόμενη ημέρα, θα πρέπει να εκτυπώνεται και αυτή η πληροφορία */
void add_duration(float duration, int hours, int minutes){
    // Διαχωρισμός της διάρκειας πτήσης σε ώρες και λεπτά.
    // Το ακέραιο μέρος της διάρκειας είναι οι ώρες της πτήσης.
    int flight_hours = (int)duration;

    // Το δεκαδικό μέρος της διάρκειας μετατρέπεται σε λεπτά.
    // Προσθέτουμε 0.5 για σωστή στρογγυλοποίηση.
    int flight_minutes = (int)((duration - flight_hours) * 60 + 0.5);

    // Προσθέτουμε τα λεπτά της πτήσης στα λεπτά της ώρας αναχώρησης.
    int arrival_minutes = minutes + flight_minutes;

    // Εάν τα λεπτά υπερβαίνουν τα 59, υπολογίζουμε τις επιπλέον ώρες.
    int extra_hours = arrival_minutes / 60;
    arrival_minutes %= 60;  // Κρατάμε μόνο τα υπόλοιπα λεπτά.

    // Προσθέτουμε τις ώρες της πτήσης και τις επιπλέον ώρες (από τα λεπτά)
    // στην ώρα αναχώρησης.
    int arrival_hours = hours + flight_hours + extra_hours;

    // Έλεγχος για το αν η ώρα άφιξης είναι της επόμενης ημέρας.
    int next_day = 0;
    if (arrival_hours >= 24)
    {
        arrival_hours %= 24;  // Μετατρέπουμε τις ώρες στο εύρος 0-23.
        next_day = 1;         // Σηματοδοτούμε ότι η άφιξη είναι την επόμενη ημέρα.
    }

    // Εκτυπώνουμε την ώρα άφιξης με την κατάλληλη μορφοποίηση.
    if (next_day)
        printf("%s%s *H Άφιξη είναι την επόμενη ημέρα: %02d:%02d\n", INDENTATION, INDENTATION, arrival_hours, arrival_minutes);
    else
        printf("%s Η Άφιξη είναι: %02d:%02d\n", INDENTATION, arrival_hours, arrival_minutes);
}
